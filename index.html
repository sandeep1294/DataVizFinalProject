<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>Visualizing LIRR Delays</title>

  <!-- Bootstrap core CSS -->
  <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom fonts for this template -->
  <link href="https://fonts.googleapis.com/css?family=Varela+Round" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">
  <script src="js/d3.v4.min.js"></script>
  <script src="js/d3.v3.min.js"></script>
  <!-- Custom styles for this template -->
  <link href="css/grayscale.min.css" rel="stylesheet">

</head>

<body id="page-top">

  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
    <div class="container">
      <a class="navbar-brand js-scroll-trigger" href="#page-top">LIRR Delays</a>
      <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
        Menu
        <i class="fas fa-bars"></i>
      </button>
      <div class="collapse navbar-collapse" id="navbarResponsive">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#overview">Overview</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#bybranchiddiv">Delays by Branch</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#hourDivViz">Delays by Hour</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#explore">Explore</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Header -->
  <header class="masthead">
    <div class="container d-flex h-100 align-items-center">
      <div class="mx-auto text-center">
        <h1 class="mx-auto my-0 text-uppercase">Long Island Rail Road</h1>
        <h2 class="text-white-50 mx-auto mt-2 mb-5">Visualizing LIRR Delays for Future Improvements</h2>
        <div id="showoverviewbutton">
          <a name="buttonanimation" href="#overview" class="btn btn-primary js-scroll-trigger">Show Visualization</a>
        </div>
        <div id="abouttheviz">
          <a class="btn btn-primary js-scroll-trigger" data-toggle="modal" data-target=".bd-example-modal-lg">About the Visualization</a>
        </div>
      </div>
    </div>
  </header>

<div class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">About the Visualization</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p>***Note: this visualization needs to be viewed with 90% zoom on a 15-inch screen for readability. If viewed on a larger screen, 100% zoom should suffice.*** </p>
        <p>The structure of LIRR delays visualization follows an interactive slideshow model. This description will briefly talk about the author driven path at the beginning and the reader led paths that can be taken at each slide of visualization. There will be a brief discussion of the annotations, parameters, triggers and how each relates to the events that readers encounter.</p>
        <p>The opening scene contains a button “Show Overview” which takes the user on a semi-author driven path showcasing each scene. At each scene, the author can decide to explore the data by hovering data points, filtering by branch and/or year, or by selecting and highlighting a portion of the parallel coordinates axis on the last scene to drill down into the data.</p>
        <h5>Parameters and Triggers</h5>
        <p>Beside each scene there is text to describe the scene and some conclusions derived from that scene and along with how it fits in the bigger story. A main difference between each scene is how the data is presented. While the bar graph shows data by branch the line graph, immediately after, shows data by the hour of the day. The implicit parameter between each scene is the filtering of data that is done behind the scenes because essentially the user has changed what data is being presented, similar to changing from year to year and different data points are plotted. For the third scene user can also filter by branch along with year, and branch and year are parameters. Filtering options presented in the dropdowns are triggers, because they result in a chain of events that change state of the data being presented. When a user clicks on option under “Filter by Year” or “Filter by Branch”, there are variables named “BY_BRANCH_YEAR”, “BY_HOUR_BRANCH” and “BY_HOUR_YEAR” that change state. These essentially change the text being display as well as the change of data point locations.</p>
        <h5>Annotations</h5>
        <p>Both of the line graphs contain annotations grabbing reader’s attention to specific points in the data. The first overview visualization shows that the peak number of delays across 2011, 2014, 2017 grew quite dramatically. Green, orange and red colors were used for coloring of the annotations to place extra emphasis on the increase in the number of delays. While the reader can determine this without the colors, the colors were used to mimic the importance of the issue at hand. The third scene uses annotations to visually inform the reader that during the rush hours there are higher number of delays. Because each scene is represented with a new view, and not a replaced view, none of the annotations are removed as one would expect from a single graph with different scenes.</p>
        <h5>Visual Consistency</h5>
        <p>Visual consistency was maintained across the entire visualization through multiple techniques. Using an opensource bootstrap theme helped narrow down to a few colors that best go together. For example, the tooltip uses the same border visual as the side text div for design consistency. Similarly, the x-axis labels for the graphs are rotated to a certain degree, where applicable, for ease of readability (especially for when the labels that are long and overlap over one another). The circle dots on the line graphs were of the same color across the graphs. However, note that for the bar chart, because of multi y-axes, two colors that were used are a subset of the twelve colors that were recommended by Ward’s “Information Visualization” (lesson 2.3.2). Color was used to emphasize the graphs and the text was either black or a shade of grey. All of the visual user interfaces are communicated to the user through button like elements, where the user can click for an event to occur, to the text displayed on the side bar, which explicitly tells users how the data can be investigated.</p>
        <h4>Choice of visualizations</h4>
        <p>The types of graphs were carefully chosen because they construct a story to let readers know that LIRR delays have significantly grown over the years. The first line graph is a perfect way to showcase this from an overview perspective while pointing out important peaks in the visualization. A line graph was chosen because data is shown over time and line graph represents that best. The y-axis starts from 1500 to spread the data evenly and use most of the graph real estate.</p>
        <p>After seeing the first line graph, an average LIRR rider would immediately think about how bad the delays are on the route that they take. The second graph answers that question leaving the readers a way to explore the data over the years. A bar graph was chosen because the x-axis data is of categorical type with no certain order. Note that for the Late By axis starts at 7 minutes because all of the data was in whole numbers ranging between 7 and 12 minutes, and it was best to evenly distribute them so that user was able to differentiate across the branches by just looking at the length of the bars – because length is one of the first few strong visual cues of showing data. The axes are of different colors as they correlate with the color of the bars that data is being represented by. This is implicit marking of the data represented, therefore making a legend unnecessary.</p>
        <p>So far users have seen which branches experience the most and the least delays. However, the real question is what part of the day do most of those delays happen? Do LIRR riders just complain during rush hours or do all riders complain about delays all the time? The third graph representing a line graph would answer leaving the user to filter the data by year and branch to see how the number of delays progressed over the years. Users can determine whether rush hours got worse or if other parts of the day got worse for the increase in delays in the last few years. This can greatly help narrow down where improvements need to be implemented.</p>
        <p>The last slide is a free-form exploration chart that lets the user explore in more detail based on the previous graphs. Due to the many data dimensions where each variable needs to be thoroughly analyzed in conjunction with others, parallel coordinates graph does the job representing the data effectively. User can drag each of the axes to filter by year, branch, from, to, and the number of delays. The number of delays axis is in logarithmic scale because the most of the data was between 0 and 500 and very few data points were above 500 thus evenly distribute those data points across the spectrum so the user can see all data effectively. The axis labels can be improved and bigger for visibility, but due to the shear volume of the data being presented it is rather tough to be both visually appealing and effective on small screens. </p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>


  <!-- Projects Section -->
  <section class="projects-section bg-light">
    <div id="overview" class="container">

      <!-- Featured Project Row -->
      <div class="row align-items-center no-gutters mb-4 mb-lg-5">
        <div class="col-xl-8 col-lg-7">
          <svg id="overviewViz" class="img-fluid mb-3 mb-lg-0">

          </svg>
        </div>
        <div class="col-xl-4 col-lg-5">
          <div class="featured-text text-center text-lg-left">
            <div id="overview" class="graphviz">

              <div class="viztext">
                <h3>Overview of Data</h3>
                <h4>Delays over the last 7 years by each quarter</h4>
                <p>The Long Island Rail Road (LIRR) has been the center of debate for many Long Islanders who travel into New York City on a daily basis. Outrage over the massive delays in recent years has become more prevalent and widespread that the newly-elected president of the MTA has made LIRR improvements a priority.</p>
                <p>This graph shows that overall increase in the number of delays over the last seven years. Spikes in the graph show certain times of year where other factors, like weather, affect the delays. However, note that the general trend of the number of delays has increased. While there may have been an increase in the number of riders, the MTA should account for this and give the exceptional service they promise to give. Hover over each of the data points to see details.</p>
              </div>

            </div>
          </div>
          <div id="showbybranchbutton" style="visibility: hidden;">
            <div class="card py-4 h-100">
              <div class="card-body text-center">
                <div class="small text-black-50 boxtext">See this graph for an overview of the number of delays over the past few years</div>
                <hr class="my-2">
                <div>
                  <a href="#bybranchiddiv" name="buttonanimation"><button type="button" class="btn btn-secondary">Next</button></a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

    <div id="bybranchiddiv" class="row align-items-center no-gutters mb-4 mb-lg-5 bybranchdivcontainer">
      <div class="col-xl-8 col-lg-7">
        <svg id="byBranchViz" class="img-fluid mb-3 mb-lg-0"></svg>
      </div>
      <div class="col-xl-4 col-lg-5">
        <div class="featured-text text-center text-lg-left">
          <div class="page-header">
            <h3 id="branchyear">Showing data for 2017</h3>
          </div>
          <p class="mb-0">Often times when improvements are made for LIRR, they are often targeted by branch. This graph show the number of delays by branch, as well as the median number of minutes for the delays. Median was chosen over the average to reduce the effect of the outliers that may have been caused by extreme weathers where heavy delays are inevitable.</p>
        </br>
        <h4>Exploring this Visualization</h4>
        <p>You can filter by year to visualize delays over the pervious years. One can note that delays have increased for some branches but reduced for others. Also explore where if delays have gotten worse from the number of minutes a train was delayed by.</p>
        <div class="dropdown row">
          <div class="col-md-6">
            <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Filter By Year
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
              <a class="dropdown-item" href="javascript: updateByBranch('2011')">2011</a>
              <a class="dropdown-item" href="javascript: updateByBranch('2012')">2012</a>
              <a class="dropdown-item" href="javascript: updateByBranch('2013')">2013</a>
              <a class="dropdown-item" href="javascript: updateByBranch('2014')">2014</a>
              <a class="dropdown-item" href="javascript: updateByBranch('2015')">2015</a>
              <a class="dropdown-item" href="javascript: updateByBranch('2016')">2016</a>
              <a class="dropdown-item" href="javascript: updateByBranch('2017')">2017</a>
            </div>
          </div>
          <div class="col-md-4">
            <a name="branchanimation"><button type="button" class="btn btn-secondary">Toggle Animation</button></a>
          </div>
        </div>
      </div>
      <div id="showbyhourbutton" style="visibility: hidden;">
        <div class="card py-4 h-100">
          <div class="card-body text-center">
            <div class="small text-black-50 boxtext">See this graph for an overview of the number of delays by branch. This is important as funding for LIRR improvements can be allocated by branch and this graph can help determine where funding is most necessary</div>
            <hr class="my-2">
            <div >
              <a href="#hourDivViz" name="buttonanimation"><button type="button" class="btn btn-secondary">Next</button></a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>



  <div class="row align-items-center no-gutters mb-4 mb-lg-5 byhourdivcontainer" id="hourDivViz">
    <div class="col-xl-8 col-lg-7">
      <svg id="byHourViz" class="img-fluid mb-3 mb-lg-0"></svg>
    </div>
    <div class="col-xl-4 col-lg-5">
      <div class="featured-text text-center text-lg-left">
        <div class="page-header">
          <h3 id="houryear">Showing data for 2017</h3>
        </div>
        <p class="mb-0">LIRR riders often face delays during rush hours. In and around NYC, morning rush hours tend to be between 6 AM and 9 AM when there is an influx into the city and evening rush hours between 4 PM and 7 PM when there is an outflux out of the city. The graph shows how the delays experienced during the outflux are significantly higher than influx into the city during the morning rush hours.</p>
        <div class="dropdown row">
          <div class="col-md-6">
            <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Filter By Year
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
              <a class="dropdown-item" href="javascript: updateByHourYear('2011')">2011</a>
              <a class="dropdown-item" href="javascript: updateByHourYear('2012')">2012</a>
              <a class="dropdown-item" href="javascript: updateByHourYear('2013')">2013</a>
              <a class="dropdown-item" href="javascript: updateByHourYear('2014')">2014</a>
              <a class="dropdown-item" href="javascript: updateByHourYear('2015')">2015</a>
              <a class="dropdown-item" href="javascript: updateByHourYear('2016')">2016</a>
              <a class="dropdown-item" href="javascript: updateByHourYear('2017')">2017</a>
            </div>
          </div>
          <div class="col-md-6">
            <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Filter By Branch
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
              <a class="dropdown-item" href="javascript: updateByHourBranch('All Branches')">All Branches</a>
              <a class="dropdown-item" href="javascript: updateByHourBranch('West Hempstead')">West Hempstead</a>
              <a class="dropdown-item" href="javascript: updateByHourBranch('Ronk. (greenpt.)')">Ronk. (greenpt.)</a>
              <a class="dropdown-item" href="javascript: updateByHourBranch('Port Washington')">Port Washington</a>
              <a class="dropdown-item" href="javascript: updateByHourBranch('Port Jefferson')">Port Jefferson</a>
              <a class="dropdown-item" href="javascript: updateByHourBranch('Oyster Bay')">Oyster Bay</a>
              <a class="dropdown-item" href="javascript: updateByHourBranch('Montauk')">Montauk</a>
              <a class="dropdown-item" href="javascript: updateByHourBranch('Long Beach')">Long Beach</a>
              <a class="dropdown-item" href="javascript: updateByHourBranch('Hunt. Hicks.')">Hunt. Hicks.</a>
              <a class="dropdown-item" href="javascript: updateByHourBranch('Hempstead')">Hempstead</a>
              <a class="dropdown-item" href="javascript: updateByHourBranch('Far Rockaway')">Far Rockaway</a>
              <a class="dropdown-item" href="javascript: updateByHourBranch('Babylon')">Babylon</a>

            </div>
          </div>
        </br>
          <div class="col-md-4 two-row-button">
            <a name="houranimation"><button type="button" class="btn btn-secondary">Toggle Animation</button></a>
          </div>
        </div>
      </div>
      <div id="showexplorebutton" style="visibility: hidden;">
        <div class="card py-4 h-100">
          <div class="card-body text-center">
            <div class="small text-black-50 boxtext">While we can expect delays during rush hours, there is certainly a limit to which a daily LIRR passenger can endure. This graph allows the readers to drill down when most delays occur during the day. Filter by year and/or branch to see how it has progressed over the years.</div>
            <hr class="my-2">
            <div >
              <a href="#exploreDivViz" name="buttonanimation"><button type="button" class="btn btn-secondary">Next</button></a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>


  <!-- Project Two Row -->
  <div class="row justify-content-center no-gutters exploredivcontainer" id="exploreDivViz">
    <div class="featured-text text-center text-lg-left">
      <h4 id="explore">Explore</h4>
      <p class="text-black-50 mb-0">Using the parallel coordinates graph below explore and research patterns in the data to determine potential future improvement for happier LIRR riders.</p>
    </div>
  </div>
  <!-- Project One Row -->
  <div class="row justify-content-center no-gutters mb-5 mb-lg-0">
    <svg id="parallelCoordViz" class="img-fluid mb-3 mb-lg-0"></svg>
  </div>

</div>
</section>

<!-- Contact Section -->
<section class="contact-section bg-black">
  <div class="container">

    <div class="row">

      <div class="col-md-4 mb-3 mb-md-0">
        <div class="card py-4 h-100">
          <div class="card-body text-center">
            <i class="fas fa-user-alt text-primary mb-2"></i>
            <h4 class="text-uppercase m-0">About the Author</h4>
            <hr class="my-4">
            <div class="small text-black-50">This visualization was created by Sandeep Vanka while studying Data Visualization at UIUC.</div>
          </div>
        </div>
      </div>

      <div class="col-md-4 mb-3 mb-md-0">
        <div class="card py-4 h-100">
          <div class="card-body text-center">
            <i class="fas fa-mobile-alt text-primary mb-2"></i>
            <h4 class="text-uppercase m-0">About this Project</h4>
            <hr class="my-4">
            <div class="small text-black-50">This project was solely to learn about presenting visualizations effectively using d3 technologies.</div>
          </div>
        </div>
      </div>

      <div class="col-md-4 mb-3 mb-md-0">
        <div class="card py-4 h-100">
          <div class="card-body text-center">
            <i class="fas fa-file text-primary mb-2"></i>
            <h4 class="text-uppercase m-0">Resources</h4>
            <hr class="my-4">
            <div class="small text-black-50">
              <a href="http://bl.ocks.org/sebastian-meier/03df214f456fc100526a">Parallel Coordinates</a>
            </br>
              <a href="http://gothamist.com/tags/LIRR">News Articles</a>
            </br>
              <a href="https://getbootstrap.com/docs/4.0/components/modal/">Bootstrap</a>
            </br>
              <a href="http://wx3z.lirr.org/latetrains/">LIRR Delays Data</a>
            </br>
              <a href="https://startbootstrap.com/template-overviews/grayscale/">Grayscale Template</a>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>
</section>

<!-- Footer -->
<footer class="bg-black small text-center text-white-50">
  <div class="container">
    Copyright &copy; LIRR Visualizations Github Pages 2018
  </div>
</footer>

<!-- Bootstrap core JavaScript -->
<script src="vendor/jquery/jquery.min.js"></script>
<script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

<!-- Plugin JavaScript -->
<script src="vendor/font-awesome/js/all.js"></script>
<script src="vendor/jquery-easing/jquery.easing.min.js"></script>

<!-- Custom scripts for this template -->
<script src="js/grayscale.min.js"></script>

<script>

  var SVG_WIDTH = 1100;
  var SVG_HEIGHT = 700;
  var BRANCH_ANIMATION = false;
  var HOUR_ANIMATION = false;
  var BY_BRANCH_YEAR = 2017;
  var BY_HOUR_YEAR =2017;
  var BY_HOUR_BRANCH = "All Branches";
  var ANNOTATION_COLOR = "orange";
  var OVERVIEW_YAXIS_MAX_NUM = 3000;

  // Define the div for the tooltip
  var tooltipDiv = d3.select("body").append("div") 
  .attr("class", "tooltip")       
  .style("opacity", 0);

  var data = d3.csv("quarterOverviewData.csv",function(data){
    updateOverviewViz(data);
  });

  var byBranchData = d3.csv("byBranchData.csv",function(data){
    updateByBranchViz(data.slice(),data.slice(),"2017","start");
    // updateByBranchLateViz(data.slice(),data.slice(),"2017","start");
  });

  var byHourData = d3.csv("byHourData.csv", function(data){
    document.getElementById("houryear").innerHTML = "Showing Data for "+BY_HOUR_BRANCH + " in " +BY_HOUR_YEAR;
    data.forEach(function(d) {
      d.NR = +d.NR;
    });
    data = filterDataByYear(data, BY_HOUR_YEAR);
    data = filterDataByBranch(data, BY_HOUR_BRANCH);
    updateByHourViz(data.slice(),data.slice(),"2017","start");
  });

  function updateByBranch(year){
    BY_BRANCH_YEAR = year;
    document.getElementById("branchyear").innerHTML = "Showing Data for "+year;
    d3.csv("byBranchData.csv",function(data){
      updateByBranchViz(data.slice(),data.slice(),year,"update");
    });}

    function updateByHourBranch(branch){
      BY_HOUR_BRANCH = branch;
      document.getElementById("houryear").innerHTML = "Showing Data for "+BY_HOUR_BRANCH + " in " +BY_HOUR_YEAR;
      d3.csv("byHourData.csv", function(data){
        data.forEach(function(d) {
          d.NR = +d.NR;
        });
        data = filterDataByYear(data, BY_HOUR_YEAR);
        data = filterDataByBranch(data, BY_HOUR_BRANCH);
        updateByHourViz(data.slice(),data.slice(),BY_HOUR_YEAR,"update");
      });
    }

    function updateByHourYear(year){
      BY_HOUR_YEAR = year;
      document.getElementById("houryear").innerHTML = "Showing Data for "+BY_HOUR_BRANCH + " in " +BY_HOUR_YEAR;
      d3.csv("byHourData.csv", function(data){
        data.forEach(function(d) {
          d.NR = +d.NR;
        });
        data = filterDataByYear(data, BY_HOUR_YEAR);
        data = filterDataByBranch(data, BY_HOUR_BRANCH);
        updateByHourViz(data.slice(),data.slice(),year,"update");
      });
    };


    function filterDataByYear(data, year)
    {
      return data.filter(function(d, i){ return (d.year==year)}); 
    };
    
    function filterDataByBranch(data, branch){
      if (branch=="All Branches") {
        OVERVIEW_YAXIS_MAX_NUM = 3000;
        return data;
      }
      OVERVIEW_YAXIS_MAX_NUM = 800;
      return data.filter(function(d, i){ return (d.branch==branch)});
    }

    function aggregateByHour(data)
    {
      return d3.nest()
      .key(function(d) { return d.hour; })
      .rollup(function(v) { return d3.sum(v,function(d) {return d.NR;});
    })
      .entries(data);
    };

    /**
    #######################################################
        
            Button Functions/Clicks logic

    #######################################################
    **/
    $("a[name=year]").on("click", function () { 
      var a = $(this).data("value"); 
      updateByBranch(a); 
    });

    $("a[name=branchanimation]").on("click", function () { 
      BRANCH_ANIMATION=!BRANCH_ANIMATION; 
    });

    $("a[name=houranimation]").on("click", function () { 
      HOUR_ANIMATION=!HOUR_ANIMATION; 
    });

    var ani = ["showoverviewbutton","showbybranchbutton","showbyhourbutton","showexplorebutton"];
    var aniState = 0;
    $("a[name=buttonanimation]").on("click", function (){
      document.getElementById(ani[aniState]).style.visibility="hidden";
      aniState = aniState+1;
      if(aniState<ani.length){
        document.getElementById(ani[aniState]).style.visibility="";  
      }else{
        aniState =0;
        document.getElementById(ani[aniState]).style.visibility="";  
      }
      
    });


    /**
    #######################################################
        
            By Hour Viz Function

    #######################################################
    **/

    var hoursMap =["Midnight", "1 AM", "2 AM", "3 AM", "4 AM", "5 AM", "6 AM", "7 AM", "8 AM", "9 AM", "10 AM", "11 AM", "Noon", "1 PM", "2 PM", "3 PM", "4 PM", "5 PM", "6 PM", "7 PM", "8 PM", "9 PM", "10 PM", "11 PM"];

    function updateByHourViz(data,origData,year,action){

      const t = d3.transition()
      .duration(750);
      data = aggregateByHour(data);
      var vizW = SVG_WIDTH;
      var vizH = SVG_HEIGHT;
      var margin = { top:20, right:20, bottom:100, left: 50 };
      var width = vizW - margin.left - margin.right;
      var height = vizH - margin.top - margin.bottom;

      var viz = d3.select("#byHourViz")
      .attr("width", vizW)
      .attr("height", vizH);

      var g = viz.append("g")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

      var xAxis = d3.scaleBand().rangeRound([0,width]);
      var yAxis = d3.scaleLinear().rangeRound([height, 0]);
      var line = d3.line()
      .x(function(d) { return xAxis(hoursMap[d.key])+14;})
      .y(function(d) { return yAxis(parseInt(d.value));})
      xAxis.domain(data.map(function(d) {return hoursMap[d.key]}));
      yAxis.domain([0,OVERVIEW_YAXIS_MAX_NUM]);

      if(action!="update"){
        var xaxisg = g.append("g")
        .attr("transform", "translate(-8,"+height+")")
        .call(d3.axisBottom(xAxis))
        .attr("class", "xaxis");

        xaxisg.selectAll("text").attr("transform", "translate(-16,20) rotate(-45)");

        g.append("text")
        .attr("fill", "#000")
        .attr("class", "xaxis")
        .attr("x",xAxis(hoursMap[data[12].key])+64)
        .attr("y", height+80)
        .attr("dy", "0.71em")
        .attr("text-anchor", "end")
        .text("Hour of Departure Time");

        viz.append("line")
        .attr("class","annotationhour1")
        .attr("x1",850)  
        .attr("y1",60)  
        .attr("x2",xAxis(hoursMap[data[16].key])+64)  
        .attr("y2",yAxis(data[16].value)+22)  
        .attr("stroke",ANNOTATION_COLOR)  
        .attr("stroke-width",2)  
        .attr("marker-end","url(#arrow)"); 

        viz.append("line")
        .attr("class","annotationhour2")
        .attr("x1",850)  
        .attr("y1",60)  
        .attr("x2",xAxis(hoursMap[data[17].key])+64)  
        .attr("y2",yAxis(data[17].value)+22)  
        .attr("stroke",ANNOTATION_COLOR)  
        .attr("stroke-width",2)  
        .attr("marker-end","url(#arrow)"); 

        viz.append("line")
        .attr("class","annotationhour3")
        .attr("x1",850)  
        .attr("y1",60)  
        .attr("x2",xAxis(hoursMap[data[18].key])+64)  
        .attr("y2",yAxis(data[18].value)+22)  
        .attr("stroke",ANNOTATION_COLOR)  
        .attr("stroke-width",2)  
        .attr("marker-end","url(#arrow)");
        viz.append("text")
        .attr("class","annotationtext")
        .attr("x",700)  
        .attr("y",58)
        .text("Considered Peak Evening Rush Hours"); 

        viz.append("line")
        .attr("class","annotationhour4")
        .attr("x1",250)  
        .attr("y1",60)  
        .attr("x2",xAxis(hoursMap[data[6].key])+64)  
        .attr("y2",yAxis(data[6].value)+22)  
        .attr("stroke",ANNOTATION_COLOR)  
        .attr("stroke-width",2)  
        .attr("marker-end","url(#arrow)"); 

        viz.append("line")
        .attr("class","annotationhour5")
        .attr("x1",250)  
        .attr("y1",60)  
        .attr("x2",xAxis(hoursMap[data[7].key])+64)  
        .attr("y2",yAxis(data[7].value)+22)  
        .attr("stroke",ANNOTATION_COLOR)  
        .attr("stroke-width",2)  
        .attr("marker-end","url(#arrow)"); 

        viz.append("line")
        .attr("class","annotationhour6")
        .attr("x1",250)  
        .attr("y1",60)  
        .attr("x2",xAxis(hoursMap[data[8].key])+64)  
        .attr("y2",yAxis(data[8].value)+22)  
        .attr("stroke",ANNOTATION_COLOR)  
        .attr("stroke-width",2)  
        .attr("marker-end","url(#arrow)");

        viz.append("text")
        .attr("class","annotationtext")
        .attr("x",200)  
        .attr("y",58)
        .text("Considered Peak Morning Rush Hours"); 
      }
      d3.select("#houridline").remove();
      d3.select("#overviewyaxisline").remove();

      g.append("g")
        .call(d3.axisLeft(yAxis))
        .attr("id","overviewyaxisline")
        .attr("class", "yaxis")
        .append("text")
        .attr("fill", "#000")
        .attr("transform", "rotate(-90)")
        .attr("y", 6)
        .attr("dy", "0.71em")
        .attr("text-anchor", "end")
        .text("Number of Delays");

      viz.select(".annotationhour1")
      .attr("x1",850)  
      .attr("y1",60)  
      .transition(t)
      .attr("x2",xAxis(hoursMap[data[16].key])+64)  
      .attr("y2",yAxis(data[16].value)+22)  
      .attr("marker-end","url(#arrow)");

      viz.select(".annotationhour2")
      .attr("x1",850)  
      .attr("y1",60)  
      .transition(t)
      .attr("x2",xAxis(hoursMap[data[17].key])+64)  
      .attr("y2",yAxis(data[17].value)+22)  
      .attr("marker-end","url(#arrow)");

      viz.select(".annotationhour3")
      .transition(t)
      .attr("x1",850)  
      .attr("y1",60)  
      .attr("x2",xAxis(hoursMap[data[18].key])+64)  
      .attr("y2",yAxis(data[18].value)+22)  
      .attr("marker-end","url(#arrow)");

      viz.select(".annotationhour4")
      .transition(t)
      .attr("x1",250)  
      .attr("y1",60)  
      .attr("x2",xAxis(hoursMap[data[6].key])+64)  
      .attr("y2",yAxis(data[6].value)+22)   
      .attr("marker-end","url(#arrow)"); 

      viz.select(".annotationhour5")
      .transition(t)
      .attr("x1",250)  
      .attr("y1",60)  
      .attr("x2",xAxis(hoursMap[data[7].key])+64)  
      .attr("y2",yAxis(data[7].value)+22)    
      .attr("marker-end","url(#arrow)"); 

      viz.select(".annotationhour6")
      .transition(t)
      .attr("x1",250)  
      .attr("y1",60)  
      .attr("x2",xAxis(hoursMap[data[8].key])+64)  
      .attr("y2",yAxis(data[8].value)+22)   
      .attr("marker-end","url(#arrow)");

      g.append("path")
      .datum(data)
      .attr("class", "line")
      .attr("id","houridline")
      .attr("fill", "none")
      .attr("stroke", "steelblue")
      .attr("stroke-linejoin", "round")
      .attr("stroke-linecap", "round")
      .attr("stroke-width",3)
      .attr("opacity", 1)
      .attr("d", line);

      viz.selectAll("circle")
      .data(data)
      .attr("class","datacircles")
      .attr("r", 5)
      .transition(t)
      .attr("cx", function(d) {
        return xAxis(hoursMap[d.key])+64;
      })
      .attr("cy", function(d) {
        return yAxis(d.value)+22;
      });


      viz.selectAll("circle")
      .data(data)
      .enter().append("circle")
      .attr("class","datacircles")
      .on("mouseover", function(d) { 
        this.style.fill="#64a19d";
        // this.parentElement.appendChild(this); 
        tooltipDiv.transition()    
        .duration(200)    
        .style("opacity", 1)

        tooltipDiv.html(hoursMap[d.key] + "<br/>"  + d.value + " Delays")  
        .style("left", (d3.event.pageX) + "px")   
        .style("top", (d3.event.pageY - 52) + "px");  
      })          
      .on("mouseout", function(d) {
        this.style.fill="";   
        tooltipDiv.transition()    
        .duration(500)    
        .style("opacity", 0); 
      })
      .attr("r", 5)
      .transition(t)
      .attr("cx", function(d) {
        return xAxis(hoursMap[d.key])+64;
      })
      .attr("cy", function(d) {
        return yAxis(d.value)+22;
      });
    }

    function updateByBranchViz(data,origData,year,action)
    {
      data = filterDataByYear(data,year);
      console.log(data);
      var vizW = SVG_WIDTH;
      var vizH = SVG_HEIGHT;
      var margin = { top:20, right:50, bottom:150, left: 50 };
      var width = vizW - margin.left - margin.right;
      var height = vizH - margin.top - margin.bottom;
      var xAxis = d3.scaleBand().rangeRound([0,width]).padding(0.1);
      var yAxis = d3.scaleLinear().rangeRound([height, 0]);
      var y1Axis = d3.scaleLinear().rangeRound([height, 0]);

      var viz = null;
      if(action=="start"){
        viz = d3.select("#byBranchViz")  
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("class","graph")
        .attr("transform", 
          "translate(" + margin.left + "," + margin.top + ")");
      }else{
        viz = d3.select("#byBranchViz");
      }

      var x1 = d3.scaleBand();
  // Scale the range of the data in the domains
  xAxis.domain(data.map(function(d) { return d.branch; }));
  yAxis.domain([0, d3.max(origData, function(d) { return parseInt(d.NR); })]);
  y1Axis.domain([7, d3.max(origData, function(d) {return parseInt(d.lateby);})]);
  x1.domain(['NR','lateby']).rangeRound([0, 50]);

  var dataset = [];
  for(i = 0; i < data.length; i++ ) {
    var br = data[i].branch;
    dataset[i] = {
      branch: br,
      values: [
      {name: "NR", value: data[i].NR, branch:data[i].branch}
      ],
      lateby: [
      {name: "lateby", value: data[i].lateby, branch:data[i].branch}
      ]
    };
  }

  const t = d3.transition()
  .duration(750);

  if(action=="start"){
    // add the x Axis
    var xaxisg = viz.append("g")
    .attr("transform", "translate(0," + height + ")")
    .call(d3.axisBottom(xAxis))
    .attr("class","branchxaxislabels");

    xaxisg.selectAll("text").attr("transform", "translate(-10,45) rotate(-45)");

    viz.append("text")
    .attr("fill", "#000")
    .attr("class", "xaxis")
    .attr("x",xAxis("Long Beach"))
    .attr("y", height+100)
    .attr("dy", "0.71em")
    .attr("text-anchor", "end")
    .text("LIRR Branch");

    // add the y Axis
    viz.append("g")
    .call(d3.axisLeft(yAxis))
    .attr("class","tickyaxis")
    .append("text")
    .attr("transform", "rotate(-90)")
    .attr("y", 6)
    .attr("dy", "0.71em")
    .attr("text-anchor", "end")
    .text("Number of Delays")
    .attr("class", "yaxislabel");


    viz.append("g")
    .call(d3.axisRight(y1Axis))
    .attr("class","ticky1axis")
    .attr("transform", "translate("+width+",0)")
    .append("text")
    .attr("fill", "#000")
    .attr("transform", "translate(-20,0) rotate(-90)")
    .attr("y", 6)
    .attr("dy", "0.71em")
    .attr("text-anchor", "end")
    .text("Late By (mins)")
    .attr("class", "yaxis");

  }


  viz.selectAll("g.bars")
  .data(dataset)
  .attr("class", "bars")
  .attr("transform", function(d) { return "translate(" + xAxis(d.branch) + ",0)"; });



  viz.selectAll("g.bars")
  .data(dataset)
  .enter()
  .append("g")
  .attr("class", "bars")
  .attr("transform", function(d) { return "translate(" + xAxis(d.branch) + ",0)"; });


  var graph = viz.selectAll("g.bars")

  graph.selectAll("rect.branchbars")
  .data(function(d) { return d.values; })
  .attr("width", 20)
  .attr("class", "branchbars")
  .attr("x", function(d) { return x1(d.name)+21; })
  // .style("fill", function(d) { return "orange"; })
  .attr("y", function(){
    var y = d3.select(this).attr("y");
    if(y==null) {return 0;}else {return y}})
  .attr("height", function(){
    var h = d3.select(this).attr("height");
    if(h==null) {return 0;}else {return h}})
  .transition(t)
  .attr("y", function(d) { return yAxis(d.value); })
  .attr("height", function(d) { return height - yAxis(d.value); });

  graph.selectAll("rect.branchbars")
  .data(function(d) { return d.values; })
  .enter()
  .append("rect")
  .attr("width", 20)
  .attr("class", "branchbars")
  .attr("x", function(d) { return x1(d.name)+21; })
  .attr("y", function(d) {return yAxis(0);})
  .on("mouseover", function(d) { 
    tooltipDiv.transition()    
    .duration(200)    
    .style("opacity", 1);    
    tooltipDiv.html(d.branch + "<br/>"  + d.value + " Delays")  
    .style("left", (d3.event.pageX) + "px")   
    .style("top", (d3.event.pageY - 52) + "px");  
  })          
  .on("mouseout", function(d) {   
    tooltipDiv.transition()    
    .duration(500)    
    .style("opacity", 0); 
  })
  .attr("height", function(){
    var h = d3.select(this).attr("height");
    if(h==null) {return 0;}else {return h}})
  .transition(t)
  .attr("y", function(d) { return yAxis(d.value); })
  .attr("height", function(d) { return height - yAxis(d.value); });

  graph.selectAll("rect.latebybars")
  .data(function(d) { return d.lateby; })
  .attr("width", 20)
  .attr("class", "latebybars")
  .attr("x", function(d) { return x1(d.name)+21; })
  .attr("y", function(){
    var y = d3.select(this).attr("y");
    if(y==null) {return 0;}else {return y}})
  .attr("height", function(){
    var h = d3.select(this).attr("height");
    if(h==null) {return 0;}else {return h}})
  .transition(t)
  .attr("y", function(d) { return y1Axis(d.value); })
  .attr("height", function(d) { return height - y1Axis(d.value); });

  graph.selectAll("rect.latebybars")
  .data(function(d) { return d.lateby; })
  .enter()
  .append("rect")
  .attr("width", 20)
  .attr("class", "latebybars")
  .attr("x", function(d) { return x1(d.name)+21; })
  .attr("y", function(d) {return y1Axis(7);})
  .on("mouseover", function(d) { 
    tooltipDiv.transition()    
    .duration(200)    
    .style("opacity", 1);    
    tooltipDiv.html(d.branch + "<br/> Median: "  + d.value + " min delays")  
    .style("left", (d3.event.pageX) + "px")   
    .style("top", (d3.event.pageY - 52) + "px");  
  })          
  .on("mouseout", function(d) {   
    tooltipDiv.transition()    
    .duration(500)    
    .style("opacity", 0); 
  })
  .attr("height", function(){
    var h = d3.select(this).attr("height");
    if(h==null) {return 0;}else {return h}})
  .transition(t)
  .attr("y", function(d) { return y1Axis(d.value); })
  .attr("height", function(d) { return height - y1Axis(d.value); });

}




function transition(path) {
  path.transition()
  .duration(5000)
  .attrTween("stroke-dasharray", tweenDash);
}
function tweenDash() {
  var l = this.getTotalLength(),
  i = d3.interpolateString("0," + l, l + "," + l);
  return function (t) { return i(t); };
}

displayAnnotations("2017")

function displayAnnotations(quarter){

  var data = d3.csv("annotations.csv",function(data){
    updateAnnotations(data);
  });
}


function updateAnnotations(data){
  data.forEach(function(d){
    var annotationsDiv = d3.select(".timelinecontainer")
    .select(".row")
    .select(".col-md-12")
    .select(".timelinediv")
    .select(".timeline");
    var liDiv = annotationsDiv
    .append("li")
    .attr("class", "timeline-item");
    liDiv
    .append("div")
    .attr("class", "timeline-badge primary")
    .html(d.year);
    var tiPanel = liDiv
    .append("div")
    .attr("class", "timeline-panel");
    var tiDivHead = tiPanel
    .append("div")
    .attr("class", "timeline-heading");
    tiDivHead
    .append("h4")
    .attr("class","timeline-title")
    .html(d.title);
    var mutedText = tiDivHead
    .append("p")
    .append("small")
    .attr("class", "text-muted")
    .html(d.QD);
    mutedText.
    append("i")
    .attr("class", "glyphicon glyphicon-time");
    tiPanel
    .append("div")
    .attr("class","timeline-body")
    .append("p")
    .html(d.text);
  });

}

function updateOverviewViz(data)
{
  var vizW = 1100;
  var vizH = 600;
  var margin = { top:20, right:20, bottom:100, left: 50 };
  var width = vizW - margin.left - margin.right;
  var height = vizH - margin.top - margin.bottom;

  var viz = d3.select("#overviewViz")
  .attr("width", vizW)
  .attr("height", vizH);

  var g = viz.append("g")
  .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

  var xAxis = d3.scaleBand().rangeRound([0,width]);
  var yAxis = d3.scaleLinear().rangeRound([height, 0]);
  var line = d3.line()
  .x(function(d) { return xAxis(d.QD)+14;})
  .y(function(d) { return yAxis(parseInt(d.NR));})
  xAxis.domain(data.map(function(d) {return d.QD}));
  yAxis.domain([parseInt(d3.extent(data, function(d) {return d.NR})[0])-1000,parseInt(d3.extent(data, function(d) {return d.NR})[1])+1000]);

  g.append("g")
  .attr("class", "xaxis")
  .attr("transform", "translate(-5,"+height+")")
  .call(d3.axisBottom(xAxis))
  .select(".domain");

  g.selectAll("text")
  .attr("transform", "translate(-18,30) rotate(-65)");

  g.append("g")
  .call(d3.axisLeft(yAxis))
  .attr("class","yaxis")
  .append("text")
  .attr("fill", "#000")
  .attr("transform", "rotate(-90)")
  .attr("y", 6)
  .attr("dy", "0.71em")
  .attr("text-anchor", "end")
  .text("Number of Delays");




  viz.append("line")
  .attr("class","annotationhour11")
  .attr("x1",150)  
  .attr("y1",60)  
  .attr("x2",xAxis(data[2].QD)+64)  
  .attr("y2",yAxis(data[2].NR)+22)  
  .attr("stroke","green")  
  .attr("stroke-width",2)  
  .attr("marker-end","url(#arrow)");

  viz.append("text")
  .attr("class","annotationtext")
  .attr("x",100)  
  .attr("y",58)
  .attr("fill", "green")
  .text("2011 highest peak"); 


  viz.append("line")
  .attr("class","annotationhour12")
  .attr("x1",475)  
  .attr("y1",60)  
  .attr("x2",xAxis(data[12].QD)+64)  
  .attr("y2",yAxis(data[12].NR)+22)  
  .attr("stroke","orange")  
  .attr("stroke-width",2)  
  .attr("marker-end","url(#arrow)"); 


  viz.append("text")
  .attr("class","annotationtext")
  .attr("x",400)  
  .attr("y",58)
  .attr("fill", "orange")
  .text("2014 highest peak"); 

  viz.append("line")
  .attr("class","annotationhour13")
  .attr("x1",850)  
  .attr("y1",60)  
  .attr("x2",xAxis(data[25].QD)+64)  
  .attr("y2",yAxis(data[25].NR)+22)  
  .attr("stroke","red")  
  .attr("stroke-width",2)  
  .attr("marker-end","url(#arrow)");

  viz.append("text")
  .attr("class","annotationtext")
  .attr("x",700)  
  .attr("y",58)
  .attr("fill", "red")
  .text("2017 highest peak, higher than 2014"); 


  g.append("path")
  .datum(data)
  .attr("class", "line")
  .attr("fill", "none")
  .attr("stroke", "steelblue")
  .attr("stroke-linejoin", "round")
  .attr("stroke-linecap", "round")
  .attr("stroke-width",3);

  g.select("path.line")
  .datum(data)
  .attr("d", line)
  .call(transition);

  viz.selectAll("dot")
  .data(data)
  .enter().append("circle")
  .attr("class","datacircles")
  .attr("r", 5)

  .attr("cx", function(d) {
    return xAxis(d.QD)+64;
  })
  .attr("cy", function(d) {
    return yAxis(d.NR)+22;
  }).on("mouseover", function(d) {    
    this.style.fill="#64a19d";
    tooltipDiv.transition()    
    .duration(200)    
    .style("opacity", 1);    
    tooltipDiv.html(d.QD + "<br/>"  + d.NR + " Delays")  
    .style("left", (d3.event.pageX) + "px")   
    .style("top", (d3.event.pageY - 52) + "px");  
  })          
  .on("mouseout", function(d) {   
    this.style.fill="";
    tooltipDiv.transition()    
    .duration(500)    
    .style("opacity", 0); 
  });

  // viz.select(".xaxis").selectAll(".tick")
  // .filter(function(d,i) {return !(i%2)})
  // .remove();

}





var margin = {top: 100, right: 100, bottom: 300, left: 100},
width = 1650 - margin.left - margin.right,
height = 1400 - margin.top - margin.bottom;

var dimensions = [
{
  name: "Year",
  scale: d3v3.scale.ordinal().rangePoints([height,0]),
  type: "string"
},
{
  name: "Branch",
  scale: d3v3.scale.ordinal().rangePoints([0, height]),
  type: "string"
},
{
  name: "From",
  scale: d3v3.scale.ordinal().rangePoints([0, height]),
  type: "string"
},
{
  name: "To",
  scale: d3v3.scale.ordinal().rangePoints([0, height]),
  type: "string"
},
{
  name: "Number of Delays",
  scale: d3v3.scale.log().range([height, 0]),
  type: "number"
},
];

var x = d3v3.scale.ordinal().domain(dimensions.map(function(d) { return d.name; })).rangePoints([0, width]),
y = {},
dragging = {};

var line = d3v3.svg.line(),
axis = d3v3.svg.axis().orient("left"),
background,
foreground;

var svg = d3v3.select("#parallelCoordViz")
.attr("width", width + margin.left + margin.right)
.attr("height", height + margin.top + margin.bottom)
.append("g")
.attr("transform", "translate(" + margin.left + "," + margin.top + ")");

d3v3.csv("pcdata.csv", function(error, data) {

    //Create the dimensions depending on attribute "type" (number|string)
    //The x-scale calculates the position by attribute dimensions[x].name
    dimensions.forEach(function(dimension) {
      dimension.scale.domain(dimension.type === "number"
        ? d3v3.extent(data, function(d) { return +d[dimension.name]; })
        : data.map(function(d) { return d[dimension.name]; }).sort());
    });

    // Add grey background lines for context.
    background = svg.append("g")
    .attr("class", "background")
    .selectAll("path")
    .data(data)
    .enter().append("path")
    .attr("d", path);

    // Add blue foreground lines for focus.
    foreground = svg.append("g")
    .attr("class", "foreground")
    .selectAll("path")
    .data(data)
    .enter().append("path")
    .attr("d", path);

    // Add a group element for each dimension.
    var g = svg.selectAll(".dimension")
    .data(dimensions)
    .enter().append("g")
    .attr("class", "dimension")
    .attr("transform", function(d) { return "translate(" + x(d.name) + ")"; })
    .call(d3v3.behavior.drag()
      .origin(function(d) { return {x: x(d.name)}; })
      .on("dragstart", function(d) {
        dragging[d.name] = x(d.name);
        background.attr("visibility", "hidden");
      })
      .on("drag", function(d) {
        dragging[d.name] = Math.min(width, Math.max(0, d3v3.event.x));
        foreground.attr("d", path);
        dimensions.sort(function(a, b) { return position(a) - position(b); });
        x.domain(dimensions.map(function(d) { return d.name; }));
        g.attr("transform", function(d) { return "translate(" + position(d) + ")"; })
      })
      .on("dragend", function(d) {
        delete dragging[d.name];
        transition(d3v3.select(this)).attr("transform", "translate(" + x(d.name) + ")");
        transition(foreground).attr("d", path);
        background
        .attr("d", path)
        .transition()
        .delay(500)
        .duration(0)
        .attr("visibility", null);
      })
      );

    // Add an axis and title.
    g.append("g")
    .attr("class", "axis")
    .each(function(d) { d3v3.select(this).call(axis.scale(d.scale)); })
    .append("text")
    .style("text-anchor", "middle")
    .attr("class", "axis-label")
    .attr("y", -19)
    .text(function(d) { return d.name; });

    g.select(".axis").selectAll("g")
    .selectAll("text").attr("class","exploreticks");

    // Add and store a brush for each axis.
    g.append("g")
    .attr("class", "brush")
    .each(function(d) {
      d3v3.select(this).call(d.scale.brush = d3v3.svg.brush().y(d.scale).on("brushstart", brushstart).on("brush", brush));
    })
    .selectAll("rect")
    .attr("x", -8)
    .attr("width", 16);
  });

function position(d) {
  var v = dragging[d.name];
  return v == null ? x(d.name) : v;
}

function transition(g) {
  return g.transition().duration(500);
}

  // Returns the path for a given data point.
  function path(d) {
    //return line(dimensions.map(function(p) { return [position(p), y[p](d[p])]; }));
    return line(dimensions.map(function(dimension) {
      var v = dragging[dimension.name];
      var tx = v == null ? x(dimension.name) : v;
      return [tx, dimension.scale(d[dimension.name])];
    }));
  }

  function brushstart() {
    d3v3.event.sourceEvent.stopPropagation();
  }

  // Handles a brush event, toggling the display of foreground lines.
  function brush() {
    var actives = dimensions.filter(function(p) { return !p.scale.brush.empty(); }),
    extents = actives.map(function(p) { return p.scale.brush.extent(); });

    foreground.style("display", function(d) {
      return actives.every(function(p, i) {
        if(p.type==="number"){
          return extents[i][0] <= parseFloat(d[p.name]) && parseFloat(d[p.name]) <= extents[i][1];
        }else{
          return extents[i][0] <= p.scale(d[p.name]) && p.scale(d[p.name]) <= extents[i][1];
        }
      }) ? null : "none";
    });
  }






  var index=0;
  var years=["2011","2012","2013","2014","2015","2016","2017"]

  d3.interval(() => {
    if(BRANCH_ANIMATION==true){
      updateByBranch(years[index%7]);
      index = index+1;
    }
    if(HOUR_ANIMATION==true){
      updateByHourYear(years[index%7]);
      index = index+1;
    }
  }, 2000);
</script>

<style>
.container {
  max-width:2000px;

}

/* Timeline */
.timeline,
.timeline-horizontal {
  list-style: none;
  padding: 20px;
  position: relative;
}
.timeline:before {
  top: 40px;
  bottom: 0;
  position: absolute;
  content: " ";
  width: 3px;
  background-color: #eeeeee;
  left: 50%;
  margin-left: -1.5px;
}
.timeline .timeline-item {
  margin-bottom: 20px;
  position: relative;
}
.timeline .timeline-item:before,
.timeline .timeline-item:after {
  content: "";
  display: table;
}
.timeline .timeline-item:after {
  clear: both;
}
.timeline .timeline-item .timeline-badge {
  color: #fff;
  width: 54px;
  height: 54px;
  line-height: 52px;
  font-size: 15px;
  text-align: center;
  position: absolute;
  top: 18px;
  left: 50%;
  margin-left: -25px;
  background-color: #7c7c7c;
  border: 3px solid #ffffff;
  z-index: 100;
  border-top-right-radius: 50%;
  border-top-left-radius: 50%;
  border-bottom-right-radius: 50%;
  border-bottom-left-radius: 50%;
}
.timeline .timeline-item .timeline-badge i,
.timeline .timeline-item .timeline-badge .fa,
.timeline .timeline-item .timeline-badge .glyphicon {
  top: 2px;
  left: 0px;
}
.timeline .timeline-item .timeline-badge.primary {
  background-color: #1f9eba;
}
.timeline .timeline-item .timeline-badge.info {
  background-color: #5bc0de;
}
.timeline .timeline-item .timeline-badge.success {
  background-color: #59ba1f;
}
.timeline .timeline-item .timeline-badge.warning {
  background-color: #d1bd10;
}
.timeline .timeline-item .timeline-badge.danger {
  background-color: #ba1f1f;
}
.timeline .timeline-item .timeline-panel {
  position: relative;
  width: 46%;
  float: left;
  right: 16px;
  border: 1px solid #c0c0c0;
  background: #ffffff;
  border-radius: 2px;
  padding: 20px;
  -webkit-box-shadow: 0 1px 6px rgba(0, 0, 0, 0.175);
  box-shadow: 0 1px 6px rgba(0, 0, 0, 0.175);
}
.timeline .timeline-item .timeline-panel:before {
  position: absolute;
  top: 26px;
  right: -16px;
  display: inline-block;
  border-top: 16px solid transparent;
  border-left: 16px solid #c0c0c0;
  border-right: 0 solid #c0c0c0;
  border-bottom: 16px solid transparent;
  content: " ";
}
.timeline .timeline-item .timeline-panel .timeline-title {
  margin-top: 0;
  color: inherit;
}
.timeline .timeline-item .timeline-panel .timeline-body > p,
.timeline .timeline-item .timeline-panel .timeline-body > ul {
  margin-bottom: 0;
}
.timeline .timeline-item .timeline-panel .timeline-body > p + p {
  margin-top: 5px;
}
.timeline .timeline-item:last-child:nth-child(even) {
  float: right;
}
.timeline .timeline-item:nth-child(even) .timeline-panel {
  float: right;
  left: 16px;
}
.timeline .timeline-item:nth-child(even) .timeline-panel:before {
  border-left-width: 0;
  border-right-width: 14px;
  left: -14px;
  right: auto;
}
.timeline-horizontal {
  list-style: none;
  position: relative;
  padding: 20px 0px 20px 0px;
  display: inline-block;
}
.timeline-horizontal:before {
  height: 3px;
  top: auto;
  bottom: 26px;
  left: 56px;
  right: 0;
  width: 100%;
  margin-bottom: 20px;
}
.timeline-horizontal .timeline-item {
  display: table-cell;
  height: 280px;
  width: 20%;
  min-width: 320px;
  float: none !important;
  padding-left: 0px;
  padding-right: 20px;
  margin: 0 auto;
  vertical-align: bottom;
}
.timeline-horizontal .timeline-item .timeline-panel {
  top: auto;
  bottom: 64px;
  display: inline-block;
  float: none !important;
  left: 0 !important;
  right: 0 !important;
  width: 100%;
  margin-bottom: 20px;
}
.timeline-horizontal .timeline-item .timeline-panel:before {
  top: auto;
  bottom: -16px;
  left: 28px !important;
  right: auto;
  border-right: 16px solid transparent !important;
  border-top: 16px solid #c0c0c0 !important;
  border-bottom: 0 solid #c0c0c0 !important;
  border-left: 16px solid transparent !important;
}
.timeline-horizontal .timeline-item:before,
.timeline-horizontal .timeline-item:after {
  display: none;
}
.timeline-horizontal .timeline-item .timeline-badge {
  top: auto;
  bottom: 0px;
  left: 43px;
}

div.tooltip { 
  position: absolute;     
  text-align: center;     
  width: 120px;          
  height: 75px;         
  padding: 5px;       
  font: 16px sans-serif;    
  background: white; 
  border: 0px;
  border-style: solid;   
  border-radius: 8px;
  border-left: .5rem solid #64a19d;
  pointer-events: none;     
}

.axis{
  font-size: 10px;
}

.yaxis{
  font-size:15px;
  color:#212529
}

.xaxis{
  font-size:14px;
  color:#212529
}



.branchxaxislabels text{
  font-size:15px;
}


.branchbars {
  fill:#4682b4;
}

.tickyaxis text{
  font-size:15px;
  fill:#4682b4;
}

.tickyaxis path{
  font-size:15px;
  stroke:#4682b4;
}

.tickyaxis line{
  font-size:15px;
  stroke:#4682b4;
}

.latebybars{
  fill:#d0743c;
}


.ticky1axis text{
  font-size:15px;
  fill:#d0743c;
}

.ticky1axis path{
  font-size:15px;
  stroke:#d0743c;
}

.ticky1axis line{
  font-size:15px;
  stroke:#d0743c;
}

#showoverviewbutton{
  padding-bottom: 20px;
}


.boxtext {
  font-size:18px;
}

.timelinecontainer {
  padding-top:100px;
}

.bybranchdivcontainer {
  padding-top:100px;
}

.byhourdivcontainer {
  padding-top:100px;
}

.exploredivcontainer {
  padding-top:100px;
}

.annotationtext {
  font-size:20px;
}

svg {
  font: 10px sans-serif;
}

.background path {
  fill: none;
  stroke: #ddd;
  shape-rendering: crispEdges;
}

.foreground path {
  fill: none;
  stroke: steelblue;
}

.brush .extent {
  fill-opacity: .3;
  stroke: #fff;
  shape-rendering: crispEdges;
}

.axis line,
.axis path {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

.axis text {
  text-shadow: 0 1px 0 #fff, 1px 0 0 #fff, 0 -1px 0 #fff, -1px 0 0 #fff;
  cursor: move;
}

.axis .axis-label {
  font-size: 18px;
  font-weight: bold;
  text-transform: uppercase;
}

.two-row-button {
  padding-top: 5px;
}


.exploreticks {
  font-size:17px;
}
</style>

</body>

</html>